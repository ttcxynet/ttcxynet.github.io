import{_ as w,s as u}from"./index.2327e925.js";import{r as k,o as m,f as _,h as t,s as d,u as p,k as g,w as f,l as b,F as x,i as v}from"./vendor.3451bb13.js";function h(s){this.message=s}h.prototype=new Error,h.prototype.name="InvalidCharacterError";var y=typeof window!="undefined"&&window.atob&&window.atob.bind(window)||function(s){var o=String(s).replace(/=+$/,"");if(o.length%4==1)throw new h("'atob' failed: The string to be decoded is not correctly encoded.");for(var l,a,e=0,r=0,i="";a=o.charAt(r++);~a&&(l=e%4?64*l+a:a,e++%4)?i+=String.fromCharCode(255&l>>(-2*e&6)):0)a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(a);return i};function D(s){var o=s.replace(/-/g,"+").replace(/_/g,"/");switch(o.length%4){case 0:break;case 2:o+="==";break;case 3:o+="=";break;default:throw"Illegal base64url string!"}try{return function(l){return decodeURIComponent(y(l).replace(/(.)/g,function(a,e){var r=e.charCodeAt(0).toString(16).toUpperCase();return r.length<2&&(r="0"+r),"%"+r}))}(o)}catch{return y(o)}}function c(s){this.message=s}function C(s,o){if(typeof s!="string")throw new c("Invalid token specified");var l=(o=o||{}).header===!0?0:1;try{return JSON.parse(D(s.split(".")[l]))}catch(a){throw new c("Invalid token specified: "+a.message)}}c.prototype=new Error,c.prototype.name="InvalidTokenError";const W={name:"login",data(){return{type:"dl",loginData:{username:"",password:"",mail:"",password1:"",rememberMe:!0}}},components:{},methods:{login(){u({url:"/api/authenticate",method:"post",data:this.loginData}).then(s=>{if(s.code===200){let o=C(s.jwt_token);localStorage.setItem("token",s.jwt_token),localStorage.setItem("author",JSON.stringify(o.author)),this.$router.push({path:"/author/"+o.sub})}})},sendMail(){u({url:"/api/mail-verify",method:"post",params:{mail:this.loginData.username}}).then(s=>{alert(s.message)})},register(){if(this.loginData.password!==this.loginData.password1){alert("\u4E24\u6B21\u5BC6\u7801\u4E0D\u4E00\u81F4");return}u({url:"/api/register",method:"post",data:this.loginData}).then(s=>{alert(s.data)})}},mounted(){localStorage.removeItem("token"),localStorage.removeItem("author")}},I={key:0,id:"loginModal",class:"modal-dialog"},S={class:"modal-content"},V=t("div",{class:"modal-header"},[t("h4",{class:"modal-title text-center"},"\u767B\u5F55")],-1),U={id:"model-body",class:"modal-body"},N=t("label",null,"\u90AE\u7BB1/\u7528\u6237\u540D\uFF1A",-1),E={class:"form-group"},j=t("label",null,"\u5BC6\u7801\uFF1A",-1),M={class:"form-group"},T={class:"modal-footer"},B={class:"btn-group W100 mb10px"},O={class:"btn-group W100 mb10px"},z={class:"btn-group W100"},A=v("\u8FD4\u56DE\u9996\u9875"),F={key:1,class:"modal-dialog"},J={class:"modal-content"},R=t("div",{class:"modal-header"},[t("h4",{class:"modal-title text-center"},"\u6CE8\u518C")],-1),q={id:"model-body",class:"modal-body"},G=t("label",null,"\u90AE\u7BB1\uFF1A",-1),H={class:"input-group"},K=t("label",null,"\u5BC6\u7801\uFF1A",-1),L={class:"form-group"},P=t("label",null,"\u786E\u8BA4\u5BC6\u7801\uFF1A",-1),Q={class:"form-group"},X={class:"modal-footer"},Y={class:"btn-group W100 mb10px"},Z={class:"btn-group W100 mb10px"},$={class:"btn-group W100"},tt=v("\u8FD4\u56DE\u9996\u9875");function ot(s,o,l,a,e,r){const i=k("router-link");return m(),_(x,null,[e.type=="dl"?(m(),_("div",I,[t("div",S,[V,t("div",U,[N,t("div",E,[d(t("input",{type:"text","onUpdate:modelValue":o[0]||(o[0]=n=>e.loginData.username=n),placeholder:"\u90AE\u7BB1/\u7528\u6237\u540D",autocomplete:"off",class:"form-control"},null,512),[[p,e.loginData.username]])]),j,t("div",M,[d(t("input",{type:"password","onUpdate:modelValue":o[1]||(o[1]=n=>e.loginData.password=n),placeholder:"\u5BC6\u7801",autocomplete:"off",class:"form-control"},null,512),[[p,e.loginData.password]])])]),t("div",T,[t("div",B,[t("button",{type:"button",class:"btn btn-primary W100",onClick:o[2]||(o[2]=n=>r.login())},"\u767B\u5F55")]),t("div",O,[t("button",{type:"button",class:"btn btn-primary W100",onClick:o[3]||(o[3]=n=>e.type="zc")},"\u6CE8\u518C")]),t("div",z,[g(i,{to:"/",type:"button",class:"btn btn-default W100"},{default:f(()=>[A]),_:1})])])])])):b("",!0),e.type=="zc"?(m(),_("div",F,[t("div",J,[R,t("div",q,[G,t("div",H,[d(t("input",{type:"text","onUpdate:modelValue":o[4]||(o[4]=n=>e.loginData.mail=n),placeholder:"\u90AE\u7BB1\u53F7",autocomplete:"off",class:"form-control"},null,512),[[p,e.loginData.mail]])]),K,t("div",L,[d(t("input",{type:"password","onUpdate:modelValue":o[5]||(o[5]=n=>e.loginData.password=n),placeholder:"\u5BC6\u7801",autocomplete:"off",class:"form-control"},null,512),[[p,e.loginData.password]])]),P,t("div",Q,[d(t("input",{type:"password","onUpdate:modelValue":o[6]||(o[6]=n=>e.loginData.password1=n),placeholder:"\u786E\u8BA4\u5BC6\u7801",autocomplete:"off",class:"form-control"},null,512),[[p,e.loginData.password1]])])]),t("div",X,[t("div",Y,[t("button",{type:"button",class:"btn btn-primary W100",onClick:o[7]||(o[7]=n=>r.register())},"\u6CE8\u518C")]),t("div",Z,[t("button",{type:"button",class:"btn btn-primary W100",onClick:o[8]||(o[8]=n=>e.type="dl")},"\u767B\u5F55")]),t("div",$,[g(i,{to:"/",type:"button",class:"btn btn-default W100"},{default:f(()=>[tt]),_:1})])])])])):b("",!0)],64)}var nt=w(W,[["render",ot]]);export{nt as default};
